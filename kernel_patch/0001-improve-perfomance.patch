From 64056d0190e646b77c4d6b7be90c1d8495303c7b Mon Sep 17 00:00:00 2001
From: hakuna77 <194330619+hakuna77@users.noreply.github.com>
Date: Fri, 28 Nov 2025 04:22:52 +0700
Subject: [PATCH] improve perfomance

---
 drivers/android/binder.c                             |  2 +-
 drivers/iio/adc/mt635x-auxadc.c                      |  2 +-
 drivers/misc/mediatek/Kconfig.default                |  1 -
 .../mediatek/sensors-1.0/alsps/alspshub/alspshub.c   |  2 +-
 .../thermal/common/thermal_zones/mtk_ts_cpu_noBank.c |  2 +-
 .../mediatek/video/mt6785/videox/primary_display.c   |  2 +-
 include/linux/audit.h                                |  4 ++++
 include/linux/lsm_audit.h                            |  8 ++++++++
 kernel/cpu.c                                         |  7 ++++---
 kernel/power/process.c                               |  6 +++---
 kernel/power/suspend.c                               |  8 ++++----
 kernel/power/wakeup_reason.c                         |  4 ++--
 security/selinux/Kconfig                             |  2 +-
 sound/soc/codecs/mt6359.c                            | 12 ++++++------
 sound/soc/mediatek/audio_dsp/audio_buf.c             | 12 ++++++------
 sound/soc/mediatek/common/mtk-afe-platform-driver.c  |  4 ++--
 sound/soc/soc-pcm.c                                  |  2 +-
 17 files changed, 46 insertions(+), 34 deletions(-)

diff --git a/drivers/android/binder.c b/drivers/android/binder.c
index c4068ccb1..ca88abc32 100644
--- a/drivers/android/binder.c
+++ b/drivers/android/binder.c
@@ -5855,7 +5855,7 @@ err:
 		thread->looper_need_return = false;
 	wait_event_interruptible(binder_user_error_wait, binder_stop_on_user_error < 2);
 	if (ret && ret != -ERESTARTSYS)
-		pr_info("%d:%d ioctl %x %lx returned %d\n", proc->pid, current->pid, cmd, arg, ret);
+		pr_debug("%d:%d ioctl %x %lx returned %d\n", proc->pid, current->pid, cmd, arg, ret);
 err_unlocked:
 	trace_binder_ioctl_done(ret);
 	return ret;
diff --git a/drivers/iio/adc/mt635x-auxadc.c b/drivers/iio/adc/mt635x-auxadc.c
index 333052b28..a1410ccc5 100644
--- a/drivers/iio/adc/mt635x-auxadc.c
+++ b/drivers/iio/adc/mt635x-auxadc.c
@@ -481,7 +481,7 @@ static int mt635x_auxadc_read_raw(struct iio_dev *indio_dev,
 		return -EINVAL;
 	}
 	if (__ratelimit(&ratelimit)) {
-		dev_info(adc_dev->dev,
+		dev_dbg(adc_dev->dev,
 			"name:%s, channel=%d, adc_out=0x%x, adc_result=%d\n",
 			auxadc_chan->ch_name, auxadc_chan->ch_num,
 			auxadc_out, *val);
diff --git a/drivers/misc/mediatek/Kconfig.default b/drivers/misc/mediatek/Kconfig.default
index 1c358767c..431e7629b 100644
--- a/drivers/misc/mediatek/Kconfig.default
+++ b/drivers/misc/mediatek/Kconfig.default
@@ -8,7 +8,6 @@ config ANDROID_DEFAULT_SETTING
 	select ARM64_SW_TTBR0_PAN
 	select ARMV8_DEPRECATED if COMPAT
 	select ASHMEM
-	select AUDIT
 	select BINFMT_ELF
 	select BINFMT_SCRIPT
 	select BLK_DEV_INITRD
diff --git a/drivers/misc/mediatek/sensors-1.0/alsps/alspshub/alspshub.c b/drivers/misc/mediatek/sensors-1.0/alsps/alspshub/alspshub.c
index f413d346c..58edf50ea 100644
--- a/drivers/misc/mediatek/sensors-1.0/alsps/alspshub/alspshub.c
+++ b/drivers/misc/mediatek/sensors-1.0/alsps/alspshub/alspshub.c
@@ -911,7 +911,7 @@ static void cabc_backlight_value_notification_work(struct work_struct *work)
 		cfg_data[2] = 0;
 		cfg_data[3] = 0;
 
-		pr_info("cabc_backlight_value_notification_work [%d, %d, %d, %d]\n",
+		pr_debug("cabc_backlight_value_notification_work [%d, %d, %d, %d]\n",
 			cfg_data[0], cfg_data[1], cfg_data[2], cfg_data[3]);
 
 		sensor_cfg_to_hub(ID_LIGHT,
diff --git a/drivers/misc/mediatek/thermal/common/thermal_zones/mtk_ts_cpu_noBank.c b/drivers/misc/mediatek/thermal/common/thermal_zones/mtk_ts_cpu_noBank.c
index d9d9af8bc..9d5e8c968 100644
--- a/drivers/misc/mediatek/thermal/common/thermal_zones/mtk_ts_cpu_noBank.c
+++ b/drivers/misc/mediatek/thermal/common/thermal_zones/mtk_ts_cpu_noBank.c
@@ -439,7 +439,7 @@ int mtk_gpufreq_register(struct mt_gpufreq_power_table_info *freqs, int num)
 		mtk_gpu_power[i].gpufreq_khz = freqs[i].gpufreq_khz;
 		mtk_gpu_power[i].gpufreq_power = freqs[i].gpufreq_power;
 
-		tscpu_printk("[%d].gpufreq_khz=%u, .gpufreq_power=%u\n",
+		tscpu_warn("[%d].gpufreq_khz=%u, .gpufreq_power=%u\n",
 			i, freqs[i].gpufreq_khz, freqs[i].gpufreq_power);
 	}
 
diff --git a/drivers/misc/mediatek/video/mt6785/videox/primary_display.c b/drivers/misc/mediatek/video/mt6785/videox/primary_display.c
index 1b735780c..2086466c6 100644
--- a/drivers/misc/mediatek/video/mt6785/videox/primary_display.c
+++ b/drivers/misc/mediatek/video/mt6785/videox/primary_display.c
@@ -6743,7 +6743,7 @@ static bool disp_rsz_frame_has_rsz_layer(struct disp_frame_cfg_t *cfg)
 	if ((path != 2 && path != 3) && (rsz == true)) {
 		struct disp_input_config *c = &cfg->input_cfg[i];
 
-		DISP_PR_ERR("not RPO but L%d(%u,%u,%ux%u)->(%u,%u,%ux%u)\n",
+		DISPDBG("not RPO but L%d(%u,%u,%ux%u)->(%u,%u,%ux%u)\n",
 			    i, c->src_offset_x, c->src_offset_y, c->src_width,
 			    c->src_height, c->tgt_offset_x, c->tgt_offset_y,
 			    c->tgt_width, c->tgt_height);
diff --git a/include/linux/audit.h b/include/linux/audit.h
index cb708eb8a..00a489f12 100644
--- a/include/linux/audit.h
+++ b/include/linux/audit.h
@@ -212,6 +212,10 @@ static inline int audit_log_task_context(struct audit_buffer *ab)
 static inline void audit_log_task_info(struct audit_buffer *ab,
 				       struct task_struct *tsk)
 { }
+static inline int audit_update_lsm_rules(void)
+{
+	return 0;
+}
 #define audit_enabled 0
 #endif /* CONFIG_AUDIT */
 
diff --git a/include/linux/lsm_audit.h b/include/linux/lsm_audit.h
index 915330abf..7ae9dcf89 100644
--- a/include/linux/lsm_audit.h
+++ b/include/linux/lsm_audit.h
@@ -117,8 +117,16 @@ int ipv4_skb_to_auditdata(struct sk_buff *skb,
 int ipv6_skb_to_auditdata(struct sk_buff *skb,
 		struct common_audit_data *ad, u8 *proto);
 
+#ifdef CONFIG_AUDIT
 void common_lsm_audit(struct common_audit_data *a,
 	void (*pre_audit)(struct audit_buffer *, void *),
 	void (*post_audit)(struct audit_buffer *, void *));
+#else
+static inline void common_lsm_audit(struct common_audit_data *a,
+	void (*pre_audit)(struct audit_buffer *, void *),
+	void (*post_audit)(struct audit_buffer *, void *))
+{
+}
+#endif
 
 #endif
diff --git a/kernel/cpu.c b/kernel/cpu.c
index 5c7a92370..059c688af 100644
--- a/kernel/cpu.c
+++ b/kernel/cpu.c
@@ -1200,10 +1200,11 @@ int freeze_secondary_cpus(int primary)
 	 */
 	cpumask_clear(frozen_cpus);
 
-	pr_info("Disabling non-boot CPUs ...\n");
+	pr_debug("Disabling non-boot CPUs ...\n");
 	for_each_online_cpu(cpu) {
 		if (cpu == primary)
 			continue;
+
 		trace_suspend_resume(TPS("CPU_OFF"), cpu, true);
 		error = _cpu_down(cpu, 1, CPUHP_OFFLINE);
 		trace_suspend_resume(TPS("CPU_OFF"), cpu, false);
@@ -1218,7 +1219,7 @@ int freeze_secondary_cpus(int primary)
 	if (!error)
 		BUG_ON(num_online_cpus() > 1);
 	else
-		pr_err("Non-boot CPUs are not disabled\n");
+		pr_debug("Non-boot CPUs are not disabled\n");
 
 	/*
 	 * Make sure the CPUs won't be enabled by someone else. We need to do
@@ -1250,7 +1251,7 @@ void enable_nonboot_cpus(void)
 	if (cpumask_empty(frozen_cpus))
 		goto out;
 
-	pr_info("Enabling non-boot CPUs ...\n");
+	pr_debug("Enabling non-boot CPUs ...\n");
 
 	arch_enable_nonboot_cpus_begin();
 
diff --git a/kernel/power/process.c b/kernel/power/process.c
index d76e61606..55c1cac98 100644
--- a/kernel/power/process.c
+++ b/kernel/power/process.c
@@ -136,7 +136,7 @@ int freeze_processes(void)
 		atomic_inc(&system_freezing_cnt);
 
 	pm_wakeup_clear(true);
-	pr_info("Freezing user space processes ... ");
+	pr_debug("Freezing user space processes ... ");
 	pm_freezing = true;
 	error = try_to_freeze_tasks(true);
 	if (!error) {
@@ -172,7 +172,7 @@ int freeze_kernel_threads(void)
 {
 	int error;
 
-	pr_info("Freezing remaining freezable tasks ... ");
+	pr_debug("Freezing remaining freezable tasks ... ");
 
 	pm_nosig_freezing = true;
 	error = try_to_freeze_tasks(false);
@@ -200,7 +200,7 @@ void thaw_processes(void)
 
 	oom_killer_enable();
 
-	pr_info("Restarting tasks ... ");
+	pr_debug("Restarting tasks ... ");
 
 	__usermodehelper_set_disable_depth(UMH_FREEZING);
 	thaw_workqueues();
diff --git a/kernel/power/suspend.c b/kernel/power/suspend.c
index 22137dd19..ebbfbec77 100644
--- a/kernel/power/suspend.c
+++ b/kernel/power/suspend.c
@@ -327,7 +327,7 @@ static int suspend_test(int level)
 {
 #ifdef CONFIG_PM_DEBUG
 	if (pm_test_level == level) {
-		pr_info("suspend debug: Waiting for %d second(s).\n",
+		pr_debug("suspend debug: Waiting for %d second(s).\n",
 				pm_test_delay);
 		mdelay(pm_test_delay * 1000);
 		return 1;
@@ -501,7 +501,7 @@ int suspend_devices_and_enter(suspend_state_t state)
 	suspend_test_start();
 	error = dpm_suspend_start(PMSG_SUSPEND);
 	if (error) {
-		pr_err("Some devices failed to suspend, or early wake event detected\n");
+		pr_debug("Some devices failed to suspend, or early wake event detected\n");
 		log_suspend_abort_reason(
 				"Some devices failed to suspend, or early wake event detected");
 		goto Recover_platform;
@@ -682,7 +682,7 @@ int pm_suspend(suspend_state_t state)
 	if (state <= PM_SUSPEND_ON || state >= PM_SUSPEND_MAX)
 		return -EINVAL;
 
-	pr_info("suspend entry (%s)\n", mem_sleep_labels[state]);
+	pr_debug("suspend entry (%s)\n", mem_sleep_labels[state]);
 	error = enter_state(state);
 	if (error) {
 		suspend_stats.fail++;
@@ -690,7 +690,7 @@ int pm_suspend(suspend_state_t state)
 	} else {
 		suspend_stats.success++;
 	}
-	pr_info("suspend exit\n");
+	pr_debug("suspend exit\n");
 	return error;
 }
 EXPORT_SYMBOL(pm_suspend);
diff --git a/kernel/power/wakeup_reason.c b/kernel/power/wakeup_reason.c
index 7a4ed59c0..95ffd6d8b 100644
--- a/kernel/power/wakeup_reason.c
+++ b/kernel/power/wakeup_reason.c
@@ -285,10 +285,10 @@ static void print_wakeup_sources(void)
 
 	if (wakeup_reason == RESUME_IRQ && !list_empty(&leaf_irqs))
 		list_for_each_entry(n, &leaf_irqs, siblings)
-			pr_info("Resume caused by IRQ %d, %s\n", n->irq,
+			pr_debug("Resume caused by IRQ %d, %s\n", n->irq,
 				n->irq_name);
 	else if (wakeup_reason == RESUME_ABNORMAL)
-		pr_info("Resume caused by %s\n", non_irq_wake_reason);
+		pr_debug("Resume caused by %s\n", non_irq_wake_reason);
 	else
 		pr_info("Resume cause unknown\n");
 
diff --git a/security/selinux/Kconfig b/security/selinux/Kconfig
index 8297e48a2..272851733 100644
--- a/security/selinux/Kconfig
+++ b/security/selinux/Kconfig
@@ -1,6 +1,6 @@
 config SECURITY_SELINUX
 	bool "NSA SELinux Support"
-	depends on SECURITY_NETWORK && AUDIT && NET && INET
+	depends on SECURITY_NETWORK && NET && INET
 	select NETWORK_SECMARK
 	default n
 	help
diff --git a/sound/soc/codecs/mt6359.c b/sound/soc/codecs/mt6359.c
index 5fa9eeaa5..13b0f5ad9 100755
--- a/sound/soc/codecs/mt6359.c
+++ b/sound/soc/codecs/mt6359.c
@@ -2616,7 +2616,7 @@ static int mt_mic_bias_0_event(struct snd_soc_dapm_widget *w,
 	bool vow_is_on = (IS_VOW_AMIC_BASE(priv->mux_select[MUX_MIC_TYPE_0]) ||
 			  IS_VOW_AMIC_BASE(priv->mux_select[MUX_MIC_TYPE_2]));
 
-	dev_info(priv->dev, "%s(), event 0x%x, mic_type %d\n",
+	dev_dbg(priv->dev, "%s(), event 0x%x, mic_type %d\n",
 		 __func__, event, mic_type);
 
 	switch (event) {
@@ -2670,7 +2670,7 @@ static int mt_mic_bias_1_event(struct snd_soc_dapm_widget *w,
 	struct mt6359_priv *priv = snd_soc_component_get_drvdata(cmpnt);
 	unsigned int mic_type = priv->mux_select[MUX_MIC_TYPE_1];
 
-	dev_info(priv->dev, "%s(), event 0x%x, mic_type %d\n",
+	dev_dbg(priv->dev, "%s(), event 0x%x, mic_type %d\n",
 		 __func__, event, mic_type);
 
 	switch (event) {
@@ -2704,7 +2704,7 @@ static int mt_mic_bias_2_event(struct snd_soc_dapm_widget *w,
 	struct mt6359_priv *priv = snd_soc_component_get_drvdata(cmpnt);
 	unsigned int mic_type = priv->mux_select[MUX_MIC_TYPE_2];
 
-	dev_info(priv->dev, "%s(), event 0x%x, mic_type %d\n",
+	dev_dbg(priv->dev, "%s(), event 0x%x, mic_type %d\n",
 		 __func__, event, mic_type);
 
 	switch (event) {
@@ -3456,7 +3456,7 @@ static int mt_pga_l_event(struct snd_soc_dapm_widget *w,
 	/* if is VOW, then force 24dB */
 	if (IS_VOW_BASE(mic_type))
 		mic_gain_l = 4;
-	dev_info(priv->dev, "%s(), event = 0x%x, mic_type %d, mic_gain_l %d, mux_pga %d\n",
+	dev_dbg(priv->dev, "%s(), event = 0x%x, mic_type %d, mic_gain_l %d, mux_pga %d\n",
 		 __func__, event, mic_type, mic_gain_l, mux_pga);
 
 	switch (event) {
@@ -3520,7 +3520,7 @@ static int mt_pga_r_event(struct snd_soc_dapm_widget *w,
 	/* if is VOW, then force 24dB */
 	if (IS_VOW_BASE(mic_type))
 		mic_gain_r = 4;
-	dev_info(priv->dev, "%s(), event = 0x%x, mic_type %d, mic_gain_r %d, mux_pga %d\n",
+	dev_dbg(priv->dev, "%s(), event = 0x%x, mic_type %d, mic_gain_r %d, mux_pga %d\n",
 		 __func__, event, mic_type, mic_gain_r, mux_pga);
 
 	switch (event) {
@@ -3581,7 +3581,7 @@ static int mt_pga_3_event(struct snd_soc_dapm_widget *w,
 	/* if is VOW, then force 24dB */
 	if (IS_VOW_BASE(mic_type))
 		mic_gain_3 = 4;
-	dev_info(priv->dev, "%s(), event = 0x%x, mic_type %d, mic_gain_3 %d, mux_pga %d\n",
+	dev_dbg(priv->dev, "%s(), event = 0x%x, mic_type %d, mic_gain_3 %d, mux_pga %d\n",
 		 __func__, event, mic_type, mic_gain_3, mux_pga);
 
 	switch (event) {
diff --git a/sound/soc/mediatek/audio_dsp/audio_buf.c b/sound/soc/mediatek/audio_dsp/audio_buf.c
index 499dbef3c..d4dcf3724 100644
--- a/sound/soc/mediatek/audio_dsp/audio_buf.c
+++ b/sound/soc/mediatek/audio_dsp/audio_buf.c
@@ -1083,7 +1083,7 @@ void dump_rbuf_bridge(struct ringbuf_bridge *ring_buffer_bridge)
 	if (ring_buffer_bridge == NULL)
 		return;
 #if defined(__linux__)
-	pr_info("%s pBufBase = 0x%llx pBufEnd = 0x%llx pRead = 0x%llx pWrite = 0x%llx bufLen=%llu readidx = 0x%llx writeidx = 0x%llx\n",
+	pr_debug("%s pBufBase = 0x%llx pBufEnd = 0x%llx pRead = 0x%llx pWrite = 0x%llx bufLen=%llu readidx = 0x%llx writeidx = 0x%llx\n",
 		 __func__, ring_buffer_bridge->pBufBase,
 		 ring_buffer_bridge->pBufEnd, ring_buffer_bridge->pRead,
 		 ring_buffer_bridge->pWrite, ring_buffer_bridge->bufLen,
@@ -1113,7 +1113,7 @@ void dump_rbuf_bridge_s(const char *appendingstring,
 	if (ring_buffer_bridge == NULL)
 		return;
 #if defined(__linux__)
-	pr_info("%s %s pBufBase = 0x%llx pBufEnd = 0x%llx pRead = 0x%llx pWrite = 0x%llx bufLen=%llu readidx = 0x%llx writeidx = 0x%llx\n",
+	pr_debug("%s %s pBufBase = 0x%llx pBufEnd = 0x%llx pRead = 0x%llx pWrite = 0x%llx bufLen=%llu readidx = 0x%llx writeidx = 0x%llx\n",
 		appendingstring, __func__, ring_buffer_bridge->pBufBase,
 		ring_buffer_bridge->pBufEnd, ring_buffer_bridge->pRead,
 		ring_buffer_bridge->pWrite, ring_buffer_bridge->bufLen,
@@ -1142,7 +1142,7 @@ void dump_rbuf(struct RingBuf *ring_buffer)
 	if (ring_buffer == NULL)
 		return;
 #if defined(__linux__)
-	pr_info("%s Base[%p] End[%p] R[%p] w[%p] Len[%d] count[%d]\n",
+	pr_debug("%s Base[%p] End[%p] R[%p] w[%p] Len[%d] count[%d]\n",
 		__func__,
 		ring_buffer->pBufBase,
 		ring_buffer->pBufEnd,
@@ -1167,7 +1167,7 @@ void dump_rbuf_s(const char *appendingstring, struct RingBuf *ring_buffer)
 	if (ring_buffer == NULL)
 		return;
 #if defined(__linux__)
-	pr_info("%s %s Base[%p] End[%p] R[%p] w[%p] Len[%d] count[%d]\n",
+	pr_debug("%s %s Base[%p] End[%p] R[%p] w[%p] Len[%d] count[%d]\n",
 		appendingstring, __func__,
 		ring_buffer->pBufBase,
 		ring_buffer->pBufEnd,
@@ -1215,7 +1215,7 @@ void dump_audio_hwbuffer(struct audio_hw_buffer *audio_hwbuf)
 	if (audio_hwbuf == NULL)
 		return;
 #if defined(__linux__)
-	pr_info(
+	pr_debug(
 		"%s hw_buffer = %d audio_memiftype = %d irq_num = %d memory_type = %d counter = %d",
 		__func__, audio_hwbuf->hw_buffer,
 		audio_hwbuf->audio_memiftype,
@@ -1238,7 +1238,7 @@ void dump_audio_hwbuffer(struct audio_hw_buffer *audio_hwbuf)
 void dump_ring_bufinfo(struct RingBuf *buf)
 {
 #if defined(__linux__)
-	pr_info(
+	pr_debug(
 		"pBufBase = %p pBufEnd = %p  pread = %p p write = %p DataCount = %u freespace = %u\n",
 		buf->pBufBase, buf->pBufEnd, buf->pRead, buf->pWrite,
 		RingBuf_getDataCount(buf), RingBuf_getFreeSpace(buf));
diff --git a/sound/soc/mediatek/common/mtk-afe-platform-driver.c b/sound/soc/mediatek/common/mtk-afe-platform-driver.c
index 3298374a6..6d7611fcb 100644
--- a/sound/soc/mediatek/common/mtk-afe-platform-driver.c
+++ b/sound/soc/mediatek/common/mtk-afe-platform-driver.c
@@ -31,7 +31,7 @@ int mtk_afe_combine_sub_dai(struct mtk_base_afe *afe)
 		num_dai_drivers += dai->num_dai_drivers;
 	}
 
-	dev_info(afe->dev, "%s(), num of dai %zd\n", __func__, num_dai_drivers);
+	dev_dbg(afe->dev, "%s(), num of dai %zd\n", __func__, num_dai_drivers);
 
 	/* combine sub_dais */
 	afe->num_dai_drivers = num_dai_drivers;
@@ -227,7 +227,7 @@ int mtk_afe_pcm_new(struct snd_soc_pcm_runtime *rtd)
 							    size, size);
 	}
 
-	dev_info(afe->dev, "%s(), dai_link_name : %s, memif_id : %d, size : %zu, ret : %d\n",
+	dev_dbg(afe->dev, "%s(), dai_link_name : %s, memif_id : %d, size : %zu, ret : %d\n",
 		 __func__,
 		 rtd->dai_link->name,
 		 rtd->cpu_dai->id,
diff --git a/sound/soc/soc-pcm.c b/sound/soc/soc-pcm.c
index 9a35a7d7a..9bd0671dd 100644
--- a/sound/soc/soc-pcm.c
+++ b/sound/soc/soc-pcm.c
@@ -2839,7 +2839,7 @@ int soc_new_pcm(struct snd_soc_pcm_runtime *rtd, int num)
 
 	pcm->private_free = soc_pcm_private_free;
 out:
-	dev_info(rtd->card->dev, "%s <-> %s mapping ok\n",
+	dev_dbg(rtd->card->dev, "%s <-> %s mapping ok\n",
 		 (rtd->num_codecs > 1) ? "multicodec" : rtd->codec_dai->name,
 		 cpu_dai->name);
 	return ret;
-- 
2.51.2

